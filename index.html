<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Reskin : Android换肤库">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Reskin</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/SethFeng/Reskin">View on GitHub</a>

          <h1 id="project_title">Reskin</h1>
          <h2 id="project_tagline">Android换肤库</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/SethFeng/Reskin/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/SethFeng/Reskin/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a id="使用方法" class="anchor" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用方法</h2>

<h2>
<a id="1-换肤主题" class="anchor" href="#1-%E6%8D%A2%E8%82%A4%E4%B8%BB%E9%A2%98" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1 换肤主题</h2>

<p>换肤主题在<code>SkinTheme</code>里枚举定义。库默认定义了两个主题-默认主题和夜间主题。要扩展主题只需仿照NIGHT，传入后缀名即可：</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c1">THIRD</span>(<span class="pl-s"><span class="pl-pds">"</span>_third<span class="pl-pds">"</span></span>) {
    @<span class="pl-smi">Override</span>
    <span class="pl-k">int</span> getId(<span class="pl-k">int</span> resId, <span class="pl-smi">String</span> defType) {
        <span class="pl-k">return</span> getNewResId(resId, getSuffix(), defType);
    }
};</pre></div>

<p>后缀名用作换肤资源的命名。</p>

<h2>
<a id="2-换肤资源" class="anchor" href="#2-%E6%8D%A2%E8%82%A4%E8%B5%84%E6%BA%90" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2 换肤资源</h2>

<p>换肤资源的定义只需注意资源的命名。将换肤资源命名为默认资源+换肤主题后缀即可。如color值：</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">color</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>textColor<span class="pl-pds">"</span></span>&gt;#FF4081&lt;/<span class="pl-ent">color</span>&gt;
&lt;<span class="pl-ent">color</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>textColor_night<span class="pl-pds">"</span></span>&gt;#3F51B5&lt;/<span class="pl-ent">color</span>&gt;
&lt;<span class="pl-ent">color</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>textColor_third<span class="pl-pds">"</span></span>&gt;#8F5230&lt;/<span class="pl-ent">color</span>&gt;</pre></div>

<p>图片资源命名，如image.png对应的夜间主题资源为image_night.png。</p>

<h2>
<a id="3-实现换肤" class="anchor" href="#3-%E5%AE%9E%E7%8E%B0%E6%8D%A2%E8%82%A4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3 实现换肤</h2>

<p>使用换肤库全面实现整个App的换肤功能，需要从Android的Application/Activity/Fragment/View层分别操作。</p>

<h4>
<a id="31-application" class="anchor" href="#31-application" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.1 Application</h4>

<p>应用启动时初始化传入Context，在应用Application <code>onCreate()</code>里添加：</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">SkinManager</span><span class="pl-k">.</span>init(<span class="pl-v">this</span>);</pre></div>

<h4>
<a id="32-activity" class="anchor" href="#32-activity" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.2 Activity</h4>

<p>支持换肤功能的Activity需继承<code>BaseSkinActivity</code>。<code>BaseSkinActivity</code>继承了<code>FragmentActivity</code>。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MainActivity</span> <span class="pl-k">extends</span> <span class="pl-e">BaseSkinActivity</span> {
    <span class="pl-c1">...</span>
}</pre></div>

<h4>
<a id="33-fragment" class="anchor" href="#33-fragment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.3 Fragment</h4>

<p>支持换肤功能的Fragment需继承<code>BaseSkinFragment</code>。在<code>onCreateView()</code>时设置Fragment布局，应使用Activity的LayoutInflater(<code>getActivity().getLayoutInflater()</code>/<code>LayoutInflater.from(getActivity())</code>)。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyFragment</span> <span class="pl-k">extends</span> <span class="pl-e">BaseSkinFragment</span> {
    <span class="pl-c1">...</span>
    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">View</span> <span class="pl-en">onCreateView</span>(<span class="pl-smi">LayoutInflater</span> <span class="pl-v">inflater</span>, <span class="pl-smi">ViewGroup</span> <span class="pl-v">container</span>, <span class="pl-smi">Bundle</span> <span class="pl-v">savedInstanceState</span>) {
        <span class="pl-k">return</span> getActivity()<span class="pl-k">.</span>getLayoutInflater()<span class="pl-k">.</span>inflate(<span class="pl-smi">R</span><span class="pl-k">.</span>layout<span class="pl-k">.</span>fragment_b, container, <span class="pl-c1">false</span>);
    }
    <span class="pl-c1">...</span>
}</pre></div>

<h4>
<a id="34-view" class="anchor" href="#34-view" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.4 View</h4>

<h5>
<a id="341-系统原生view" class="anchor" href="#341-%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%94%9Fview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.4.1 系统原生View</h5>

<h6>
<a id="--xml布局中" class="anchor" href="#--xml%E5%B8%83%E5%B1%80%E4%B8%AD" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- xml布局中</h6>

<p>不用操作，全都由换肤库自行管理。</p>

<h6>
<a id="--手动addview" class="anchor" href="#--%E6%89%8B%E5%8A%A8addview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- 手动addView</h6>

<p>需要将View及其换肤关注属性添加到换肤管理。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">/** 动态添加系统View */</span>
<span class="pl-smi">LinearLayout</span> linearLayout <span class="pl-k">=</span> (<span class="pl-smi">LinearLayout</span>) findViewById(<span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>root);
<span class="pl-smi">TextView</span> tv <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">TextView</span>(<span class="pl-v">this</span>);
<span class="pl-k">int</span> colorResId <span class="pl-k">=</span> <span class="pl-smi">R</span><span class="pl-k">.</span>color<span class="pl-k">.</span>textColor;
tv<span class="pl-k">.</span>setTextColor(getResources()<span class="pl-k">.</span>getColor(colorResId));
linearLayout<span class="pl-k">.</span>addView(tv);

<span class="pl-c">/** 动态添加系统View不走onCreateView,需要手动添加换肤关注属性 */</span>
<span class="pl-k">List&lt;<span class="pl-smi">DynamicViewAttribute</span>&gt;</span> attrs <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;&gt;</span>();
attrs<span class="pl-k">.</span>add(<span class="pl-k">new</span> <span class="pl-smi">DynamicViewAttribute</span>(<span class="pl-s"><span class="pl-pds">"</span>textColor<span class="pl-pds">"</span></span>, colorResId));
addSkinView(tv, attrs);</pre></div>

<h5>
<a id="342-自定义view" class="anchor" href="#342-%E8%87%AA%E5%AE%9A%E4%B9%89view" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.4.2 自定义View</h5>

<p>自定义View需按以下规则定义，不需关心是在布局xml中还是手动addView。</p>

<h6>
<a id="--实现ondraw" class="anchor" href="#--%E5%AE%9E%E7%8E%B0ondraw" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- 实现onDraw()</h6>

<p>实现了onDraw()的自定义View，修改让其继承自CustomSkinView，在onDraw()里获取主题资源并设置。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">SkinnableView</span> <span class="pl-k">extends</span> <span class="pl-e">CustomSkinView</span> {
    <span class="pl-k">int</span> mColor;

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">void</span> <span class="pl-en">setSkinTheme</span>(<span class="pl-smi">SkinTheme</span> <span class="pl-v">theme</span>) {
        mColor <span class="pl-k">=</span> theme<span class="pl-k">.</span>getColor(<span class="pl-smi">R</span><span class="pl-k">.</span>color<span class="pl-k">.</span>textColor);
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">void</span> <span class="pl-en">onDraw</span>(<span class="pl-smi">Canvas</span> <span class="pl-v">canvas</span>) {
        <span class="pl-c1">...</span>
        mPaint<span class="pl-k">.</span>setColor(mColor);
        <span class="pl-c1">...</span>
    }   
}</pre></div>

<h6>
<a id="--其它" class="anchor" href="#--%E5%85%B6%E5%AE%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>- 其它</h6>

<p>未实现onDraw()的自定义View，需要自行实现<code>ICustomSkinView</code>接口，实现<code>reSkin()</code>方法设置换肤，并在<code>onAttachedToWindow()</code>/<code>onDetachedFromWindow()</code>添加/移除换肤管理。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">CustomLinearLayout</span> <span class="pl-k">extends</span> <span class="pl-e">LinearLayout</span> <span class="pl-k">implements</span> <span class="pl-e">ICustomSkinView</span> {
    <span class="pl-k">int</span> mColor;
    <span class="pl-c1">...</span>

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">reSkin</span>(<span class="pl-smi">SkinTheme</span> <span class="pl-v">theme</span>) {
        <span class="pl-c">// 获取主题资源</span>
        mColor <span class="pl-k">=</span> theme<span class="pl-k">.</span>getColor(<span class="pl-smi">R</span><span class="pl-k">.</span>color<span class="pl-k">.</span>textColor);
        <span class="pl-c">// 设置主题资源</span>
        setBackgroundColor(mColor);
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">void</span> <span class="pl-en">onAttachedToWindow</span>() {
        <span class="pl-v">super</span><span class="pl-k">.</span>onAttachedToWindow();
        <span class="pl-c">// 添加到换肤管理</span>
        ((<span class="pl-smi">BaseSkinActivity</span>) getContext())<span class="pl-k">.</span>addCustomView(<span class="pl-v">this</span>);
        <span class="pl-c">// 初始化主题</span>
        reSkin(<span class="pl-smi">SkinManager</span><span class="pl-k">.</span>getTheme());
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">void</span> <span class="pl-en">onDetachedFromWindow</span>() {
        <span class="pl-v">super</span><span class="pl-k">.</span>onDetachedFromWindow();
        <span class="pl-c">// 移除换肤管理</span>
        ((<span class="pl-smi">BaseSkinActivity</span>) getContext())<span class="pl-k">.</span>removeCustomView(<span class="pl-v">this</span>);
    }
}</pre></div>

<h4>
<a id="35-触发换肤" class="anchor" href="#35-%E8%A7%A6%E5%8F%91%E6%8D%A2%E8%82%A4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.5 触发换肤</h4>

<p>触发换肤的Activity主动设置全局的换肤主题，并通过调用<code>reSkin()</code>主动触发本Activity的换肤。其它Activity的换肤会在<code>onResume()</code>自行完成，不需主动触发。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">void</span> changeSkin(<span class="pl-smi">SkinTheme</span> targetTheme) {
    <span class="pl-smi">SkinManager</span><span class="pl-k">.</span>reSkin(targetTheme);
    reSkin(targetTheme);
}</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Reskin maintained by <a href="https://github.com/SethFeng">SethFeng</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
