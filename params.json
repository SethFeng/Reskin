{"name":"Reskin","tagline":"Android换肤库","body":"## 使用方法\r\n## 1 换肤主题\r\n换肤主题在`SkinTheme`里枚举定义。库默认定义了两个主题-默认主题和夜间主题。要扩展主题只需仿照NIGHT，传入后缀名即可：\r\n```java\r\nTHIRD(\"_third\") {\r\n    @Override\r\n    int getId(int resId, String defType) {\r\n        return getNewResId(resId, getSuffix(), defType);\r\n    }\r\n};\r\n```\r\n后缀名用作换肤资源的命名。\r\n## 2 换肤资源\r\n换肤资源的定义只需注意资源的命名。将换肤资源命名为默认资源+换肤主题后缀即可。如color值：\r\n```xml\r\n<color name=\"textColor\">#FF4081</color>\r\n<color name=\"textColor_night\">#3F51B5</color>\r\n<color name=\"textColor_third\">#8F5230</color>\r\n```\r\n图片资源命名，如image.png对应的夜间主题资源为image_night.png。\r\n## 3 实现换肤\r\n使用换肤库全面实现整个App的换肤功能，需要从Android的Application/Activity/Fragment/View层分别操作。\r\n#### 3.1 Application\r\n应用启动时初始化传入Context，在应用Application `onCreate()`里添加：\r\n```java\r\nSkinManager.init(this);\r\n```\r\n#### 3.2 Activity\r\n支持换肤功能的Activity需继承`BaseSkinActivity`。`BaseSkinActivity`继承了`FragmentActivity`。\r\n```java\r\npublic class MainActivity extends BaseSkinActivity {\r\n    ...\r\n}\r\n```\r\n#### 3.3 Fragment\r\n支持换肤功能的Fragment需继承`BaseSkinFragment`。在`onCreateView()`时设置Fragment布局，应使用Activity的LayoutInflater(`getActivity().getLayoutInflater()`/`LayoutInflater.from(getActivity())`)。\r\n```java\r\npublic class MyFragment extends BaseSkinFragment {\r\n    ...\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\r\n        return getActivity().getLayoutInflater().inflate(R.layout.fragment_b, container, false);\r\n    }\r\n    ...\r\n}\r\n```\r\n#### 3.4 View\r\n##### 3.4.1 系统原生View\r\n###### - xml布局中\r\n不用操作，全都由换肤库自行管理。\r\n###### - 手动addView\r\n需要将View及其换肤关注属性添加到换肤管理。\r\n```java\r\n/** 动态添加系统View */\r\nLinearLayout linearLayout = (LinearLayout) findViewById(R.id.root);\r\nTextView tv = new TextView(this);\r\nint colorResId = R.color.textColor;\r\ntv.setTextColor(getResources().getColor(colorResId));\r\nlinearLayout.addView(tv);\r\n\r\n/** 动态添加系统View不走onCreateView,需要手动添加换肤关注属性 */\r\nList<DynamicViewAttribute> attrs = new ArrayList<>();\r\nattrs.add(new DynamicViewAttribute(\"textColor\", colorResId));\r\naddSkinView(tv, attrs);\r\n```\r\n##### 3.4.2 自定义View\r\n自定义View需按以下规则定义，不需关心是在布局xml中还是手动addView。\r\n###### - 实现onDraw()\r\n实现了onDraw()的自定义View，修改让其继承自CustomSkinView，在onDraw()里获取主题资源并设置。\r\n```java\r\npublic class SkinnableView extends CustomSkinView {\r\n    int mColor;\r\n\r\n    @Override\r\n    protected void setSkinTheme(SkinTheme theme) {\r\n        mColor = theme.getColor(R.color.textColor);\r\n    }\r\n\r\n    @Override\r\n    protected void onDraw(Canvas canvas) {\r\n        ...\r\n        mPaint.setColor(mColor);\r\n        ...\r\n    }   \r\n}\r\n```\r\n###### - 其它\r\n未实现onDraw()的自定义View，需要自行实现`ICustomSkinView`接口，实现`reSkin()`方法设置换肤，并在`onAttachedToWindow()`/`onDetachedFromWindow()`添加/移除换肤管理。\r\n```java\r\npublic class CustomLinearLayout extends LinearLayout implements ICustomSkinView {\r\n    int mColor;\r\n    ...\r\n\r\n    @Override\r\n    public void reSkin(SkinTheme theme) {\r\n        // 获取主题资源\r\n        mColor = theme.getColor(R.color.textColor);\r\n        // 设置主题资源\r\n        setBackgroundColor(mColor);\r\n    }\r\n\r\n    @Override\r\n    protected void onAttachedToWindow() {\r\n        super.onAttachedToWindow();\r\n        // 添加到换肤管理\r\n        ((BaseSkinActivity) getContext()).addCustomView(this);\r\n        // 初始化主题\r\n        reSkin(SkinManager.getTheme());\r\n    }\r\n\r\n    @Override\r\n    protected void onDetachedFromWindow() {\r\n        super.onDetachedFromWindow();\r\n        // 移除换肤管理\r\n        ((BaseSkinActivity) getContext()).removeCustomView(this);\r\n    }\r\n}\r\n```\r\n#### 3.5 触发换肤\r\n触发换肤的Activity主动设置全局的换肤主题，并通过调用`reSkin()`主动触发本Activity的换肤。其它Activity的换肤会在`onResume()`自行完成，不需主动触发。\r\n```java\r\nvoid changeSkin(SkinTheme targetTheme) {\r\n    SkinManager.reSkin(targetTheme);\r\n    reSkin(targetTheme);\r\n}\r\n```","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}